name: build-and-test

on: [push, pull_request]

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    - name: Setup ROS
      uses: ros-tooling/setup-ros@v0.7

    - name: Update GPG Keyring
      run: |
        sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys F42ED6FBAB17C654
        sudo apt-get update -o Acquire::CompressionTypes::Order::=gz

    - name: Initialize rosdep
      run: |
        if [ ! -f /etc/ros/rosdep/sources.list.d/20-default.list ]; then
          sudo rosdep init
        fi
        rosdep update

    - name: Install dependencies
      env:
        ROS_PYTHON_VERSION: 3
      run: rosdep install --from-paths src --ignore-src -r -y

    - name: Install Python dependencies
      run: python3 -m pip install -r requirements.txt

    - name: Build the package
      run: colcon build --packages-select behavior_tree

    - name: Run custom tests
      run: python3 src/behavior_tree/behavior_tree/test.py
